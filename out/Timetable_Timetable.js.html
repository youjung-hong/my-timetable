<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>JSDoc: Source: Timetable/Timetable.js</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link
      type="text/css"
      rel="stylesheet"
      href="styles/prettify-tomorrow.css"
    />
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css" />
  </head>

  <body>
    <div id="main">
      <h1 class="page-title">Source: Timetable/Timetable.js</h1>

      <section>
        <article>
          <pre
            class="prettyprint source linenums"
          ><code>import UI_TEMPLATE from './template/TimetableTemplate'
import { TaskItemList } from '../TaskItemList/TaskItemList'
import TaskItemDomUtil from '../TaskItemDomUtil/TaskItemDomUtil'
import { TaskItem } from '../TaskItem/TaskItem'

/**
 * @class
 * @constructor
 * @param {string} id - root element id
 * @param {TaskItem[]} items - task items
 * @example
 * const timetable = new Timetable('root');
 * @example
 * const timetable = new Timetable('root', [new TaskItem()])
 */
export class Timetable {
  constructor(id, items) {
    this.rootElement = document.getElementById(id)

    if (this.rootElement) {
      this.rootElement.className = 'root'
      this.rootElement.innerHTML = UI_TEMPLATE
    }

    this.list = new TaskItemList(items)

    this.drawItems(this.list.items)
  }

  /**
   * insert new item and draw it on timetable
   * @param {TaskItem} item - a new item
   */
  insert(item) {
    this.list.add(item)
    this.drawItem(item)
  }

  /**
   * update an item and redraw it on timetable
   * @param {TaskItem} item - an existing item to update
   */
  update(item) {
    this.list.update(item)
    this.eraseItem(item.id)
    this.drawItem(item)
  }

  /**
   * delete an item and erase it on timetable
   * @param {TaskItem} item - an existing item to delete
   */
  delete(item) {
    this.list.remove(item.id)
    this.eraseItem(item.id)
  }

  /**
   * delete an element having item id data from timetable
   * @private
   * @param {number} itemId
   */
  eraseItem(itemId) {
    Array.from(
      this.rootElement.querySelectorAll(`div[data-item-id='${itemId}']`)
    ).forEach((element) => {
      element.parentElement.removeChild(element)
    })
  }

  /**
   * draw an item on timetable
   * @private
   * @param {TaskItem} item - a task item
   */
  drawItem(item) {
    const positions = TaskItemDomUtil.calculatePositions(item)

    positions.forEach((position) => {
      if (position.hour >= 24) {
        return
      }

      const element = document.createElement('div')
      element.dataset.itemId = item.id
      element.className = 'task-log'
      element.style.width = position.width
      element.style.height = position.height
      element.style.top = position.top
      element.style.left = position.left

      this.rootElement.appendChild(element)
    })
  }

  /**
   * draw all items on timetable
   * @param {TaskItem[]} items - all task items
   */
  drawItems(items) {
    items.forEach((item) => this.drawItem(item))
  }
}
</code></pre>
        </article>
      </section>
    </div>

    <nav>
      <h2><a href="index.html">Home</a></h2>
      <h3>Classes</h3>
      <ul>
        <li><a href="TaskItem.html">TaskItem</a></li>
        <li><a href="TaskItemList.html">TaskItemList</a></li>
        <li><a href="Timetable.html">Timetable</a></li>
      </ul>
    </nav>

    <br class="clear" />

    <footer>
      Documentation generated by
      <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Sun May 24
      2020 15:42:46 GMT+0900 (GMT+09:00)
    </footer>

    <script>
      prettyPrint()
    </script>
    <script src="scripts/linenumber.js"></script>
  </body>
</html>
